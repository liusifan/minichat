# Makefile
#
# Generated by phxrpc_pb2server from cert.proto
#
#

include ../../comm.mk

include ../../phxrpc/phxrpc.mk

CFLAGS += $(REDIS_CLIENT_INCLUDE) -I$(MINICHAT_ROOT)/minichat \
		  -I$(MINICHAT_ROOT)/third_party/yassl -DUSE_SYS_STL

LDFLAGS :=  $(PLUGIN_ELPP_LDFLAGS) \
	-L$(MINICHAT_ROOT)/third_party/yassl/lib -ltaocrypt \
	-L$(PHXRPC_ROOT)/lib -lphxrpc \
	$(LDFLAGS) \
	$(REDIS_CLIENT_LIBRARY)

#choose to use boost for network
#LDFLAGS := $(PLUGIN_BOOST_LDFLAGS) $(LDFLAGS)

SVR_OBJS = cert.pb.o \
		   cert_service_impl.o \
		   phxrpc_cert_service.o \
		   phxrpc_cert_dispatcher.o \
		   cert_server_config.o \
		   cert_main.o \
		   pem_file.o \
		   cert_codec.o

CLI_OBJS = cert.pb.o \
		   cert_client.o \
		   phxrpc_cert_stub.o \
		   pem_file.o

TARGETS = libcert_client.a cert_main cert_tool_main

all: $(TARGETS)

cert_main: $(SVR_OBJS)
	$(LINKER) $^ $(LDFLAGS) -o $@

libcert_client.a: $(CLI_OBJS)
	$(AR) $@ $^

cert_tool_main: phxrpc_cert_tool.o cert_tool_impl.o cert_tool_main.o
	$(LINKER) $^ -L. -lcert_client $(LDFLAGS) -o $@

########## message ##########

cert.pb.cc: cert.pb.h

cert.pb.h: cert.proto
	$(PROTOBUF_ROOT)/bin/protoc -I$(PROTOBUF_ROOT)/include --cpp_out=. -I$(PHXRPC_ROOT) -I. $^

########## client ##########

phxrpc_cert_stub.cpp: phxrpc_cert_stub.h
phxrpc_cert_stub.o: phxrpc_cert_stub.h
cert_client.cpp: phxrpc_cert_stub.h
cert_client.o: phxrpc_cert_stub.h

phxrpc_cert_stub.h: cert.proto
	$(PHXRPC_ROOT)/codegen/phxrpc_pb2client $(PBFLAGS) -f $^ -d .

########## service ##########

phxrpc_cert_service.cpp: phxrpc_cert_service.h
phxrpc_cert_service.o: phxrpc_cert_service.h
cert_service_impl.cpp: phxrpc_cert_service.h
cert_service_impl.o: phxrpc_cert_service.h
phxrpc_cert_dispatcher.cpp: phxrpc_cert_service.h
phxrpc_cert_dispatcher.o: phxrpc_cert_service.h

phxrpc_cert_service.h: cert.proto
	$(PHXRPC_ROOT)/codegen/phxrpc_pb2service $(PBFLAGS) -f $^ -d .

########## tool ##########

phxrpc_cert_tool.cpp: phxrpc_cert_tool.h
phxrpc_cert_tool.o: phxrpc_cert_tool.h
cert_tool_impl.cpp: phxrpc_cert_tool.h
cert_tool_impl.o: phxrpc_cert_tool.h
cert_tool_main.cpp: phxrpc_cert_tool.h
cert_tool_main.o: phxrpc_cert_tool.h

phxrpc_cert_tool.h: cert.proto
	$(PHXRPC_ROOT)/codegen/phxrpc_pb2tool $(PBFLAGS) -f $^ -d .

clean:
	@($(RM) $(TARGETS))
	@($(RM) *.o)
	@($(RM) phxrpc_*)
	@($(RM) *.pb.*)


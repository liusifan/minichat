# Makefile
#
# Generated by phxrpc_pb2server from logic.proto
#
#

include ../../comm.mk

CFLAGS += $(LOGIC_CFLAGS)
LDFLAGS += $(LOGIC_LDFLAGS)

#choose to use boost for network
#LDFLAGS := $(PLUGIN_BOOST_LDFLAGS) $(LDFLAGS)

CGI_OBJS = cgi_base.o cgi_auth.o cgi_sendmsg.o cgi_sync.o 

SVR_OBJS = logic.pb.o \
		   logic_service_impl.o \
		   phxrpc_logic_service.o \
		   phxrpc_logic_dispatcher.o \
		   logic_server_config.o \
		   logic_main.o \
		   $(CGI_OBJS)

CLI_OBJS = logic.pb.o \
		   logic_client.o \
		   phxrpc_logic_stub.o \
		   minichat_api.o

TARGETS = liblogic_client.a logic-main logic_tool_main

all: $(TARGETS)

logic-main: $(SVR_OBJS) 
	$(LINKER) $^ $(LDFLAGS) -o $@

liblogic_client.a: $(CLI_OBJS)
	$(AR) $@ $^

logic_tool_main: phxrpc_logic_tool.o logic_tool_impl.o logic_tool_main.o
	$(LINKER) $^ -L. -llogic_client $(LDFLAGS) -o $@

########## message ##########

logic.pb.cc: logic.pb.h

logic.pb.h: logic.proto
	$(PROTOBUF_ROOT)/bin/protoc -I$(PROTOBUF_ROOT)/include --cpp_out=. -I$(PHXRPC_ROOT) -I. $^

########## client ##########

phxrpc_logic_stub.cpp: phxrpc_logic_stub.h
phxrpc_logic_stub.o: phxrpc_logic_stub.h
logic_client.cpp: phxrpc_logic_stub.h
logic_client.o: phxrpc_logic_stub.h

phxrpc_logic_stub.h: logic.proto
	$(PHXRPC_ROOT)/codegen/phxrpc_pb2client $(PBFLAGS) -f $^ -d .

########## service ##########

phxrpc_logic_service.cpp: phxrpc_logic_service.h
phxrpc_logic_service.o: phxrpc_logic_service.h
logic_service_impl.cpp: phxrpc_logic_service.h
logic_service_impl.o: phxrpc_logic_service.h
phxrpc_logic_dispatcher.cpp: phxrpc_logic_service.h
phxrpc_logic_dispatcher.o: phxrpc_logic_service.h

phxrpc_logic_service.h: logic.proto
	$(PHXRPC_ROOT)/codegen/phxrpc_pb2service $(PBFLAGS) -f $^ -d .

########## tool ##########

phxrpc_logic_tool.cpp: phxrpc_logic_tool.h
phxrpc_logic_tool.o: phxrpc_logic_tool.h
logic_tool_impl.cpp: phxrpc_logic_tool.h
logic_tool_impl.o: phxrpc_logic_tool.h
logic_tool_main.cpp: phxrpc_logic_tool.h
logic_tool_main.o: phxrpc_logic_tool.h

phxrpc_logic_tool.h: logic.proto
	$(PHXRPC_ROOT)/codegen/phxrpc_pb2tool $(PBFLAGS) -f $^ -d .

clean:
	@($(RM) $(TARGETS))
	@($(RM) *.o)
	@($(RM) phxrpc_*)
	@($(RM) *.pb.*)

